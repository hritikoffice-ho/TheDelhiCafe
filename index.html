<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Delhi Cafe ‚Äî Menu & Order</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <style>
    :root {
      --accent: #ff9a1c;
      --accent-dark: #d87b00;
      --bg-1: #fff7eb;
      --bg-2: #fffaf0;
      --card: #ffffff;
      --muted: #6b7280;
      --shadow: 0 8px 30px rgba(0,0,0,0.12);
      --text: #222;
      --overlay: rgba(0,0,0,0.45);
      --radius: 12px;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg-1: #0f0f10;
        --bg-2: #121212;
        --card: #1c1c1c;
        --muted: #c7c7c7;
        --shadow: 0 10px 40px rgba(0,0,0,0.6);
        --text: #fff;
      }
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Poppins', sans-serif; background: linear-gradient(180deg, var(--bg-1) 0%, var(--bg-2) 100%) fixed; color: var(--text); line-height: 1.6; }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }

    header { position: sticky; top: 0; z-index: 100; background: linear-gradient(90deg, var(--accent), var(--accent-dark)); color: #fff; padding: 16px 20px; box-shadow: var(--shadow); display: flex; align-items: center; justify-content: space-between; }
    .logo { display: flex; align-items: center; gap: 12px; }
    .logo img { width: 50px; height: 50px; border-radius: 10px; background: #fff; padding: 4px; }
    .logo h1 { font-size: 20px; font-weight: 700; }
    .header-info { text-align: right; font-size: 13px; }

    .min-banner { width: 100%; text-align: center; background: var(--accent); color: #fff; padding: 10px 16px; font-size: 15px; font-weight: 700; letter-spacing: 0.3px; box-shadow: var(--shadow); margin-bottom: 10px; }

    .search-bar { margin: 20px 0; display: flex; gap: 10px; }
    .search-bar input { flex: 1; padding: 12px 16px; border: 2px solid #ddd; border-radius: var(--radius); font-size: 15px; background: var(--card); color: var(--text); }
    .search-bar input:focus { outline: none; border-color: var(--accent); }

    .categories { display: flex; gap: 10px; overflow-x: auto; padding: 10px 0; margin-bottom: 20px; }
    .category-btn { padding: 8px 16px; border: 2px solid var(--accent); background: var(--card); color: var(--accent); border-radius: 999px; cursor: pointer; white-space: nowrap; font-weight: 600; transition: all 0.3s; }
    .category-btn:hover, .category-btn.active { background: var(--accent); color: #fff; }

    .menu-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; margin-bottom: 100px; }
    .menu-item { background: var(--card); border-radius: var(--radius); overflow: hidden; box-shadow: var(--shadow); transition: transform 0.3s; }
    .menu-item:hover { transform: translateY(-4px); }
    .menu-item img { width: 100%; height: 180px; object-fit: cover; background: #f0f0f0; }
    .menu-item-content { padding: 16px; }
    .menu-item h3 { font-size: 18px; margin-bottom: 8px; color: var(--text); }
    .menu-item p { font-size: 13px; color: var(--muted); margin-bottom: 12px; min-height: 40px; }
    .menu-item-footer { display: flex; justify-content: space-between; align-items: center; }
    .price { font-size: 20px; font-weight: 700; color: var(--accent); }
    .add-btn { background: var(--accent); color: #fff; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s; }
    .add-btn:hover { background: var(--accent-dark); }
    .add-btn:disabled { background: #999; cursor: not-allowed; }

    .cart-floater { position: fixed; bottom: 20px; right: 20px; z-index: 200; background: var(--accent); color: #fff; padding: 14px 20px; border-radius: 999px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); cursor: pointer; display: flex; align-items: center; gap: 10px; font-weight: 700; transition: all 0.3s; }
    .cart-floater:hover { transform: scale(1.05); }
    .cart-badge { background: #fff; color: var(--accent); padding: 4px 10px; border-radius: 999px; font-size: 14px; }

    .overlay { position: fixed; inset: 0; background: var(--overlay); z-index: 300; display: none; backdrop-filter: blur(4px); }
    .overlay.show { display: block; }

    .drawer { position: fixed; right: 0; top: 0; bottom: 0; width: 400px; max-width: 90%; background: var(--card); box-shadow: -20px 0 50px rgba(0,0,0,0.5); transform: translateX(100%); transition: transform 0.3s; z-index: 400; overflow-y: auto; padding: 20px; }
    .drawer.open { transform: translateX(0); }
    .drawer h2 { margin-bottom: 20px; color: var(--text); }
    .close-btn { position: absolute; top: 20px; right: 20px; background: none; border: none; font-size: 24px; cursor: pointer; color: var(--muted); }

    .cart-items { margin-bottom: 20px; }
    .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #eee; }
    .cart-item-info { flex: 1; }
    .cart-item-name { font-weight: 600; color: var(--text); }
    .cart-item-price { font-size: 13px; color: var(--muted); }
    .qty-controls { display: flex; gap: 8px; align-items: center; }
    .qty-btn { background: var(--accent); color: #fff; border: none; width: 28px; height: 28px; border-radius: 6px; cursor: pointer; font-weight: 700; }

    .cart-summary { border-top: 2px solid #eee; padding-top: 16px; margin-top: 16px; }
    .summary-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 15px; }
    .summary-row.total { font-size: 20px; font-weight: 700; color: var(--accent); margin-top: 12px; }

    .checkout-form { margin-top: 20px; display: none; }
    .checkout-form.show { display: block; }
    .form-group { margin-bottom: 16px; }
    .form-group label { display: block; margin-bottom: 6px; font-weight: 600; color: var(--text); font-size: 14px; }
    .form-group input, .form-group textarea { width: 100%; padding: 10px 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; background: var(--card); color: var(--text); }
    .form-group input:focus, .form-group textarea:focus { outline: none; border-color: var(--accent); }
    .form-group textarea { resize: vertical; min-height: 80px; }

    .btn-primary { width: 100%; background: var(--accent); color: #fff; border: none; padding: 14px; border-radius: 8px; font-size: 16px; font-weight: 700; cursor: pointer; transition: all 0.3s; margin-top: 10px; }
    .btn-primary:hover { background: var(--accent-dark); }
    .btn-primary:disabled { background: #999; cursor: not-allowed; }
    .btn-secondary { width: 100%; background: #6b7280; color: #fff; border: none; padding: 12px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s; margin-top: 10px; }

    .loading { text-align: center; padding: 40px; color: var(--muted); }
    .spinner { border: 3px solid #f3f3f3; border-top: 3px solid var(--accent); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 16px; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    .message { padding: 12px 16px; border-radius: 8px; margin-bottom: 16px; font-weight: 600; }
    .message.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .message.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }

    footer { background: var(--card); color: var(--muted); text-align: center; padding: 20px; margin-top: 40px; border-top: 1px solid #eee; }
    footer p { font-size: 14px; margin: 4px 0; }
    footer a { color: var(--accent); text-decoration: none; font-weight: 600; }
    footer a:hover { text-decoration: underline; }

    @media (max-width: 768px) {
      .drawer { width: 100%; }
      .menu-grid { grid-template-columns: 1fr; }
      .min-banner { font-size: 13px; padding: 8px 12px; }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">
      <img src="https://i.ibb.co/VYWpNSsS/logo.png" alt="Logo">
      <div>
        <h1>The Delhi Cafe</h1>
        <small>Fresh ¬∑ Fast ¬∑ Local</small>
      </div>
    </div>
    <div class="header-info">
      <div>Open 10 AM - 2 AM</div>
      <div>üìç Brahmpuri, Delhi</div>
    </div>
  </header>

  <div class="min-banner">
    ‚≠ê Free home delivery within 2 km  ¬∑ Minimum order ‚Çπ250‚≠ê
  </div>

  <div class="container">
    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="Search dishes...">
    </div>

    <div class="categories" id="categories"></div>

    <div id="menuContainer">
      <div class="loading">
        <div class="spinner"></div>
        <p>Loading menu...</p>
      </div>
    </div>
  </div>

  <div class="cart-floater" id="cartFloater" style="display: none;">
    üõí Cart
    <span class="cart-badge" id="cartCount">0</span>
    <span id="cartTotal">‚Çπ0</span>
  </div>

  <div class="overlay" id="overlay"></div>

  <div class="drawer" id="drawer">
    <button class="close-btn" id="closeDrawer">√ó</button>
    <h2>Your Cart</h2>
    
    <div id="messageContainer"></div>
    
    <div class="cart-items" id="cartItems"></div>
    
    <div class="cart-summary">
      <div class="summary-row">
        <span>Subtotal</span>
        <span id="subtotal">‚Çπ0</span>
      </div>
      <div class="summary-row" id="taxRow" style="display: none;">
        <span>Tax (5%)</span>
        <span id="tax">‚Çπ0</span>
      </div>
      <div class="summary-row total">
        <span>Total</span>
        <span id="total">‚Çπ0</span>
      </div>
    </div>

    <div class="checkout-form" id="checkoutForm">
      <h3 style="margin-bottom: 16px;">Delivery Details</h3>
      <div class="form-group">
        <label>Full Name *</label>
        <input type="text" id="customerName" required placeholder="Enter your name">
      </div>
      <div class="form-group">
        <label>Phone Number *</label>
        <input type="tel" id="customerPhone" required placeholder="10-digit mobile number">
      </div>
      <div class="form-group">
        <label>Delivery Address *</label>
        <textarea id="customerAddress" required placeholder="House/Flat No, Street, Area, Landmark"></textarea>
      </div>
    </div>

    <button class="btn-primary" id="checkoutBtn" style="display: none;">Proceed to Checkout</button>
    <button class="btn-secondary" id="clearCartBtn" style="display: none;">Clear Cart</button>
  </div>

  <footer>
    <p>&copy; 2025 The Delhi Cafe. All rights reserved.</p>
    <p>Developed by <a href="#">Hritik Verma</a></p>
  </footer>

  <script>
    // ========== CONFIGURATION - UPDATE THESE URLs ==========
    const API_CONFIG = {
      MENU_API: 'http://localhost:5678/webhook/webapp/menu-data',
      CREATE_ORDER_API: 'http://localhost:5678/webhook/create-order',
      PAYMENT_CALLBACK_API: 'http://localhost:5678/webhook/payment-callback'
    };
    
    const ENABLE_TAX = false;
    const TAX_RATE = 0.05;
    const MIN_ORDER = 250;
    // ========================================================

    let menuData = [];
    let cart = {};
    let activeCategory = 'All';
    let checkoutMode = false;

    async function loadMenu() {
      try {
        const response = await fetch(API_CONFIG.MENU_API);
        const data = await response.json();
        
        if (data.menu && Array.isArray(data.menu)) {
          menuData = data.menu.flatMap(cat => 
            cat.items.map(item => ({...item, category: cat.category}))
          );
        } else if (Array.isArray(data)) {
          menuData = data;
        } else {
          menuData = [];
        }
        
        renderCategories();
        renderMenu();
      } catch (error) {
        console.error('Error loading menu:', error);
        document.getElementById('menuContainer').innerHTML = 
          '<div class="message error">Failed to load menu. Please refresh.</div>';
      }
    }

    function renderCategories() {
      const categories = ['All', ...new Set(menuData.map(item => item.category || 'Other'))];
      document.getElementById('categories').innerHTML = categories.map(cat => 
        `<button class="category-btn ${cat === activeCategory ? 'active' : ''}" onclick="filterCategory('${cat}')">${cat}</button>`
      ).join('');
    }

    function filterCategory(category) {
      activeCategory = category;
      renderCategories();
      renderMenu();
    }

    function renderMenu() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const filtered = menuData.filter(item => {
        const matchesCategory = activeCategory === 'All' || item.category === activeCategory;
        const matchesSearch = !searchTerm || 
          (item.name || '').toLowerCase().includes(searchTerm) || 
          (item.description || '').toLowerCase().includes(searchTerm);
        return matchesCategory && matchesSearch;
      });

      const container = document.getElementById('menuContainer');
      if (filtered.length === 0) {
        container.innerHTML = '<div class="message">No items found.</div>';
        return;
      }

      container.innerHTML = `<div class="menu-grid">${filtered.map(item => {
        const available = item.available !== false;
        const inCart = cart[item.id] || 0;
        return `
          <div class="menu-item">
            <img src="${item.image_url || item.image || 'https://via.placeholder.com/280x180?text=No+Image'}" alt="${item.name}">
            <div class="menu-item-content">
              <h3>${item.name}</h3>
              <p>${item.description || ''}</p>
              <div class="menu-item-footer">
                <span class="price">‚Çπ${item.price}</span>
                ${available ? 
                  (inCart > 0 ? 
                    `<div class="qty-controls">
                      <button class="qty-btn" onclick="changeQty('${item.id}', -1)">-</button>
                      <span>${inCart}</span>
                      <button class="qty-btn" onclick="changeQty('${item.id}', 1)">+</button>
                    </div>` : 
                    `<button class="add-btn" onclick="addToCart('${item.id}')">Add +</button>`
                  ) : 
                  '<button class="add-btn" disabled>Out of Stock</button>'
                }
              </div>
            </div>
          </div>
        `;
      }).join('')}</div>`;
    }

    function addToCart(itemId) {
      cart[itemId] = (cart[itemId] || 0) + 1;
      updateCart();
      renderMenu();
    }

    function changeQty(itemId, delta) {
      cart[itemId] = (cart[itemId] || 0) + delta;
      if (cart[itemId] <= 0) delete cart[itemId];
      updateCart();
      renderMenu();
    }

    function updateCart() {
      const items = Object.keys(cart).map(id => {
        const item = menuData.find(m => m.id == id);
        return item ? { ...item, qty: cart[id] } : null;
      }).filter(Boolean);

      const subtotal = items.reduce((sum, item) => sum + (item.price * item.qty), 0);
      const tax = ENABLE_TAX ? Math.round(subtotal * TAX_RATE) : 0;
      const total = subtotal + tax;

      if (!ENABLE_TAX) {
        document.getElementById('taxRow').style.display = 'none';
      }

      const totalItems = items.reduce((sum, item) => sum + item.qty, 0);
      document.getElementById('cartCount').textContent = totalItems;
      document.getElementById('cartTotal').textContent = `‚Çπ${total}`;
      document.getElementById('cartFloater').style.display = totalItems > 0 ? 'flex' : 'none';

      const cartItemsContainer = document.getElementById('cartItems');
      if (items.length === 0) {
        cartItemsContainer.innerHTML = '<p style="color: var(--muted); text-align: center; padding: 20px;">Your cart is empty</p>';
        document.getElementById('checkoutBtn').style.display = 'none';
        document.getElementById('clearCartBtn').style.display = 'none';
      } else {
        cartItemsContainer.innerHTML = items.map(item => `
          <div class="cart-item">
            <div class="cart-item-info">
              <div class="cart-item-name">${item.name}</div>
              <div class="cart-item-price">‚Çπ${item.price} √ó ${item.qty}</div>
            </div>
            <div class="qty-controls">
              <button class="qty-btn" onclick="changeQty('${item.id}', -1)">-</button>
              <span>${item.qty}</span>
              <button class="qty-btn" onclick="changeQty('${item.id}', 1)">+</button>
            </div>
          </div>
        `).join('');
        document.getElementById('checkoutBtn').style.display = 'block';
        document.getElementById('clearCartBtn').style.display = 'block';
      }

      document.getElementById('subtotal').textContent = `‚Çπ${subtotal}`;
      document.getElementById('tax').textContent = `‚Çπ${tax}`;
      document.getElementById('total').textContent = `‚Çπ${total}`;
    }

    function showMessage(text, type = 'success') {
      const container = document.getElementById('messageContainer');
      container.innerHTML = `<div class="message ${type}">${text}</div>`;
      setTimeout(() => container.innerHTML = '', 5000);
    }

    async function checkout() {
      if (!checkoutMode) {
        document.getElementById('checkoutForm').classList.add('show');
        document.getElementById('checkoutBtn').textContent = 'Place Order & Pay';
        checkoutMode = true;
        return;
      }

      const customerName = document.getElementById('customerName').value.trim();
      const customerPhone = document.getElementById('customerPhone').value.trim();
      const customerAddress = document.getElementById('customerAddress').value.trim();

      if (!customerName || !customerPhone || !customerAddress) {
        showMessage('Please fill all required fields', 'error');
        return;
      }

      if (!/^\d{10}$/.test(customerPhone)) {
        showMessage('Please enter a valid 10-digit phone number', 'error');
        return;
      }

      const orderItems = Object.keys(cart).map(id => {
        const item = menuData.find(m => m.id == id);
        return { item_id: id, name: item.name, price: item.price, quantity: cart[id] };
      });

      const subtotal = orderItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      
      if (subtotal < MIN_ORDER) {
        showMessage(`Minimum order value is ‚Çπ${MIN_ORDER}`, 'error');
        return;
      }

      const tax = ENABLE_TAX ? Math.round(subtotal * TAX_RATE) : 0;
      const total = subtotal + tax;

      const orderPayload = {
        cart: orderItems,
        customer_name: customerName,
        phone: customerPhone,
        delivery_address: customerAddress,
        subtotal: subtotal,
        tax: tax,
        total_amount: total
      };

      const checkoutButton = document.getElementById('checkoutBtn');
      checkoutButton.disabled = true;
      checkoutButton.textContent = 'Creating order...';

      try {
        const response = await fetch(API_CONFIG.CREATE_ORDER_API, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(orderPayload)
        });

        const orderResponse = await response.json();

        if (!response.ok || !orderResponse.success) {
          throw new Error(orderResponse.message || 'Failed to create order');
        }

        if (!orderResponse.payment_link_url) {
          throw new Error('Payment link not received');
        }

        showMessage('Order created! Redirecting to payment...', 'success');
        
        setTimeout(() => {
          window.location.href = orderResponse.payment_link_url;
        }, 1000);

      } catch (error) {
        console.error('Checkout error:', error);
        showMessage(`Failed: ${error.message}`, 'error');
        checkoutButton.disabled = false;
        checkoutButton.textContent = 'Place Order & Pay';
      }
    }

    function clearCart() {
      if (confirm('Clear all items from cart?')) {
        cart = {};
        updateCart();
        renderMenu();
        checkoutMode = false;
        document.getElementById('checkoutForm').classList.remove('show');
        document.getElementById('checkoutBtn').textContent = 'Proceed to Checkout';
      }
    }

    function openDrawer() {
      document.getElementById('drawer').classList.add('open');
      document.getElementById('overlay').classList.add('show');
    }

    function closeDrawer() {
      document.getElementById('drawer').classList.remove('open');
      document.getElementById('overlay').classList.remove('show');
    }

    document.getElementById('cartFloater').addEventListener('click', openDrawer);
    document.getElementById('closeDrawer').addEventListener('click', closeDrawer);
    document.getElementById('overlay').addEventListener('click', closeDrawer);
    document.getElementById('checkoutBtn').addEventListener('click', checkout);
    document.getElementById('clearCartBtn').addEventListener('click', clearCart);
    document.getElementById('searchInput').addEventListener('input', renderMenu);

    loadMenu();
  </script>
</body>
</html>
